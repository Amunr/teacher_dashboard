<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Debug</title>
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .status { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .success { border-color: #28a745; background: #d4edda; }
        .warning { border-color: #ffc107; background: #fff3cd; }
    </style>
</head>
<body>
    <h1>Dashboard Debug Page</h1>
    <div id="status"></div>
    
    <h2>Test Results:</h2>
    <div id="results"></div>
    
    <h2>Raw Data:</h2>
    <pre id="raw-data" style="background: #f5f5f5; padding: 10px; border-radius: 5px;"></pre>

    <script>
        console.log('Debug page loaded');
        
        function addStatus(message, type = 'status') {
            const statusDiv = document.getElementById('status');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            statusDiv.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function addResult(title, content) {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.innerHTML = `<strong>${title}:</strong> ${content}`;
            div.style.margin = '10px 0';
            resultsDiv.appendChild(div);
        }

        async function testAPI() {
            addStatus('Testing API endpoints...', 'status');
            
            try {
                // Test dashboard data endpoint
                addStatus('Calling /api/dashboard-data...', 'status');
                const dashResponse = await fetch('/api/dashboard-data');
                addStatus(`Dashboard API response status: ${dashResponse.status}`, dashResponse.ok ? 'success' : 'error');
                
                if (dashResponse.ok) {
                    const dashData = await dashResponse.json();
                    addResult('Dashboard Data Keys', Object.keys(dashData).join(', '));
                    addResult('Total Students', dashData.total_students || 'N/A');
                    addResult('Average Score', dashData.average_score || 'N/A');
                    document.getElementById('raw-data').textContent = JSON.stringify(dashData, null, 2);
                } else {
                    addStatus(`Dashboard API failed: ${dashResponse.statusText}`, 'error');
                }

                // Test student list endpoint
                addStatus('Calling /api/student-list...', 'status');
                const studentResponse = await fetch('/api/student-list');
                addStatus(`Student API response status: ${studentResponse.status}`, studentResponse.ok ? 'success' : 'error');
                
                if (studentResponse.ok) {
                    const studentData = await studentResponse.json();
                    addResult('Student Data Keys', Object.keys(studentData).join(', '));
                    addResult('Student Count', studentData.students ? studentData.students.length : 'N/A');
                }

            } catch (error) {
                addStatus(`Error: ${error.message}`, 'error');
                console.error('API Test Error:', error);
            }
        }

        // Test when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            addStatus('DOM Content Loaded - starting tests', 'success');
            testAPI();
        });

        // Test immediately as well
        addStatus('Page script executing', 'success');
        
        // Check if we can make a simple request
        setTimeout(() => {
            addStatus('Testing delayed API call...', 'status');
            fetch('/api/dashboard-data')
                .then(response => {
                    addStatus(`Delayed test response: ${response.status}`, response.ok ? 'success' : 'error');
                })
                .catch(error => {
                    addStatus(`Delayed test error: ${error.message}`, 'error');
                });
        }, 1000);
    </script>
</body>
</html>
