


{#
Variables required for this template:

layout_name: str (name of the layout)
layout_id: int
domains: List of dicts, each with:
    id: int
    name: str
    subdomains: List of dicts, each with:
        id: int
        name: str
        questions: List of dicts, each with:
            id: int
            name: str
            question_id: int
metadata_list: List of dicts, each with:
    id: int
    name: str
    question_id: int
layout_start_date: str (YYYY-MM-DD)
layout_end_date: str (YYYY-MM-DD)
current_year: int
#}

{% extends "layout.html" %}

{% block title %}Layout Builder - Question Management{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold text-primary mb-0">
                        <i class="bi bi-diagram-3 me-2"></i>
                        {{ layout_name or 'Layout Builder' }}
                    </h2>
                    {% if layout_id %}
                    <div class="text-muted small">ID: {{ layout_id }}</div>
                    {% endif %}
                </div>
                <form method="post" action="{{ url_for('add_domain') }}">
                    <button class="btn btn-success btn-lg" type="submit">
                        <i class="bi bi-plus-circle me-2"></i>Add Domain
                    </button>
                </form>
            </div>
            <p class="text-muted">Manage your question hierarchy and metadata structure</p>
        </div>
    </div>

    <form method="post" action="{{ url_for('submit_layout') }}">
        <div class="row">
            <div class="col-12">
                <div class="card border-3 rounded-4 shadow-lg">
                    <div class="card-body p-5">
                        <!-- Domains -->
                        {% for domain in domains %}
                        <div class="domain-card mb-4">
                            <div class="card border-primary border-3 rounded-4 shadow-lg">
                                <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-diagram-3 text-primary me-2"></i>
                                        <input type="text" name="domain_name_{{ domain.id }}" class="form-control form-control-lg border-0 bg-transparent fw-bold" value="{{ domain.name }}">
                                    </div>
                                    <button name="delete_domain" value="{{ domain.id }}" class="btn btn-outline-danger btn-sm" type="submit">
                                        <i class="bi bi-x-circle"></i>
                                    </button>
                                </div>
                                <div class="card-body">
                                    {% for subdomain in domain.subdomains %}
                                    <div class="subdomain-card mb-3 ms-4">
                                        <div class="card border-secondary border-2 rounded-3">
                                            <div class="card-header bg-secondary bg-opacity-10 d-flex justify-content-between align-items-center">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-collection text-secondary me-2"></i>
                                                    <input type="text" name="subdomain_name_{{ domain.id }}_{{ subdomain.id }}" class="form-control form-control-sm border-0 bg-transparent fw-semibold" value="{{ subdomain.name }}">
                                                </div>
                                                <button name="delete_subdomain" value="{{ domain.id }}_{{ subdomain.id }}" class="btn btn-outline-danger btn-sm" type="submit">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </div>
                                            <div class="card-body">
                                                {% for question in subdomain.questions %}
                                                <div class="question-row mb-2 ms-4">
                                                    <div class="row g-2">
                                                        <div class="col-md-6">
                                                            <input type="text" name="question_name_{{ domain.id }}_{{ subdomain.id }}_{{ question.id }}" class="form-control form-control-sm border-info border-2 rounded-3" value="{{ question.name }}">
                                                        </div>
                                                        <div class="col-md-4">
                                                            <input type="number" name="question_id_{{ domain.id }}_{{ subdomain.id }}_{{ question.id }}" class="form-control form-control-sm border-info border-2 rounded-3" value="{{ question.question_id }}" min="1" step="1">
                                                        </div>
                                                        <div class="col-md-2">
                                                            <button name="delete_question" value="{{ domain.id }}_{{ subdomain.id }}_{{ question.id }}" class="btn btn-outline-danger btn-sm w-100" type="submit">
                                                                <i class="bi bi-x-circle"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                                <div class="text-center mt-2">
                                                    <button name="add_question" value="{{ domain.id }}_{{ subdomain.id }}" class="btn btn-outline-secondary btn-sm" type="submit">
                                                        <i class="bi bi-plus-circle me-1"></i>Add Question
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                    <div class="text-center mt-3">
                                        <button name="add_subdomain" value="{{ domain.id }}" class="btn btn-outline-primary" type="submit">
                                            <i class="bi bi-plus-circle me-2"></i>Add Subdomain
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}

                        <!-- Metadata Section -->
                        <div class="mt-5">
                            <div class="card border-info border-3 rounded-4 shadow-lg">
                                <div class="card-header bg-info bg-opacity-10">
                                    <h5 class="fw-bold text-info mb-0">
                                        <i class="bi bi-database me-2"></i>MetaData
                                    </h5>
                                </div>
                                <div class="card-body">
                                    {% for metadata in metadata_list %}
                                    <div class="metadata-row mb-2">
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <input type="text" class="form-control form-control-sm border-info border-2 rounded-3 bg-light" value="{{ metadata.name }}" readonly>
                                            </div>
                                            <div class="col-md-4">
                                                <input type="number" name="metadata_id_{{ metadata.id }}" class="form-control form-control-sm border-info border-2 rounded-3" value="{{ metadata.question_id }}" min="1" step="1">
                                            </div>
                                            <div class="col-md-2">
                                                <div class="text-muted text-center pt-2">
                                                    <i class="bi bi-lock"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- Date Controls -->
                        <div class="row mt-5">
                            <div class="col-md-4">
                                <label for="layoutStartDate" class="form-label fw-bold">Layout Start Date:</label>
                                <input type="date" class="form-control form-control-lg border-warning border-3 rounded-4" name="layout_start_date" id="layoutStartDate" value="{{ layout_start_date or current_year ~ '-01-01' }}">
                            </div>
                            <div class="col-md-4">
                                <label for="layoutEndDate" class="form-label fw-bold">Layout End Date:</label>
                                <input type="date" class="form-control form-control-lg border-warning border-3 rounded-4" name="layout_end_date" id="layoutEndDate" value="{{ layout_end_date or current_year ~ '-12-31' }}">
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button class="btn btn-primary btn-lg w-100" type="submit">
                                    <i class="bi bi-check-circle me-2"></i>Submit Layout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}